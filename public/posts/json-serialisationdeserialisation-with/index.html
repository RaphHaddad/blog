<!doctype html>

<html lang="en-us">

<head>
  <title>Raph&#39;s Blog</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.49" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="/">Raph&rsquo;s Blog</a>
            </h1>

      <ul id="social-media">
             
      </ul>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Archive</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>JSON serialisation/deserialisation with snake_case naming conventions</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2014-12-02T14:38:00&#43;11:00">Dec 2, 2014</time>
        </li>
        
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/.net/">#.net</a>
                
                    , 
                    <a href="/tags/serialisation/">#serialisation</a>
                
                    , 
                    <a href="/tags/json/">#json</a>
                
                    , 
                    <a href="/tags/c/">#c#</a>
                
                    , 
                    <a href="/tags/serialization/">#serialization</a>
                
            </em>
        </li>
        

        <li>4 min read</li>
    </ul>
</aside>
    

    

<p><a href="https://github.com/RaphHaddad/Newtonsoft.Json.Serialization.ContractResolverExtentions">GitHub (NuGet package source)</a><br />
<a href="https://github.com/RaphHaddad/JsonSerializationExample">GitHub (Usage example)</a><br />
<a href="https://www.nuget.org/packages/Json.NET.ContractResolverExtentions/">Nuget Package</a></p>

<p>JSON is quickly becoming the norm for data transfer along the HTTP protocol and for many of us it is a daily task to serialise into and from JSON.</p>

<p>The problem with JSON, however, is the fact that there is no standard associated with its naming conventions. Let me give you an example.</p>

<p>Below is a snipet of JSON from the Twitter API:</p>

<pre><code> {     &quot;id&quot;: 85011021,      &quot;id_str&quot;: &quot;85011021&quot;,      &quot;name&quot;: &quot;Raph&quot;,      &quot;screen_name&quot;: &quot;RaphHaddadAus&quot;,      &quot;location&quot;: &quot;Sydney&quot;,      &quot;profile_location&quot;: null   }  
</code></pre>

<p>And here is JSON from the Google + API:</p>

<pre><code> {      &quot;objectType&quot;: &quot;person&quot;,      &quot;id&quot;: &quot;104264388447663009734&quot;,      &quot;displayName&quot;: &quot;Raphael Haddad&quot;   }  
</code></pre>

<p>As you can see there is no consistency between the property names in each of the examples. This issue is quite widespread and some providers have their properties as <strong>snake_case</strong>, others are <strong>camelCase</strong> and others are <strong>PascalCase</strong></p>

<p>What makes things even more complicated is that there are different standards within some naming conventions as well. Let&rsquo;s take <strong>snake_case</strong> as an example:</p>

<p>Below are two naming conventions that can be written in snake_case:</p>

<ul>
<li>page_section2</li>
<li>page_section_2

<br /></li>
</ul>

<p>So how do we serialise to and from objects in C# while maintaining statically typed classes with proper C# naming conventions?</p>

<h3 id="some-solutions">Some Solutions</h3>

<ul>
<li>change the C# property conventions from <strong>PascalCase</strong> to <strong>snake_case</strong></li>

<li><p>add an attribute for EACH property</p></li>

<li><p>example: [DataMember(Name = &ldquo;user_id&rdquo;)]</p></li>
</ul>

<h3 id="a-good-solution">A Good Solution</h3>

<p>Firstly, I will be using the Json.NET serialisation library to demonstrate how to serialise and deserialise Objects to and from JSON.</p>

<p>In this library. You can specify how you wish to convert property names by creating  JsonSetting object. You also specify how a specific Class&rsquo;s properties should be serialised by setting the ContractResolver property.</p>

<pre><code>       var jsonSettings = new JsonSerializerSettings         {           ContractResolver = new DefaultContractResolver(),           NullValueHandling = NullValueHandling.Ignore         };         var json = JsonConvert.SerializeObject(data, jsonSettings);  
</code></pre>

<p>Json.NET already comes with a class DefaultContractResolver and CamelCasePropertyNamesContractResolver the former serializes an object strictly on the property naming conventions. While the later changes everything to <strong>camelCase</strong>. </p>

<p>What I have done is created two classes that inherit from the DefaultContractResolverand override the method ResolvePropertyName </p>

<pre><code>   public class SnakeCasePropertyNamesContractResolver : DefaultContractResolver     {       protected override string ResolvePropertyName(string propertyName)       {         var startUnderscores = System.Text.RegularExpressions.Regex.Match(propertyName, @&quot;^_+&quot;);         return startUnderscores + System.Text.RegularExpressions.Regex           .Replace(propertyName, @&quot;([A-Z])&quot;, &quot;_$1&quot;).ToLower().TrimStart('_');       }     }     public class SnakeCaseIntegerSeperatedPropertyNamesContractResolver : DefaultContractResolver     {       protected override string ResolvePropertyName(string propertyName)       {         var startUnderscores = System.Text.RegularExpressions.Regex.Match(propertyName, @&quot;^_+&quot;);         return startUnderscores + System.Text.RegularExpressions.Regex           .Replace(propertyName, @&quot;([A-Z0-9])&quot;, &quot;_$1&quot;).ToLower().TrimStart('_');       }     }  
</code></pre>

<p>The class SnakeCasePropertyNamesContractResolver serializes properties into the format <strong>snake_case1</strong></p>

<p>And SnakeCaseIntegerSeperatedPropertyNamesContractResolver serializes properties into the format <strong>snake_case_1 </strong></p>

<p>You can use these two classes by:</p>

<ol>
<li> creating a JsonSerializerSettings object. </li>
<li>Assigning the property of this object ContractResolver to a new instance of either SnakeCasePropertyNamesContractResolver or SnakeCaseIntegerSeperatedPropertyNamesContractResolver. </li>
<li>Then serialising and deserialising the object using JsonConvert.SerializeObject() or JsonConvert.DeserializeObject() </li>
</ol>

<p>These classes simply work by using Regex to pattern match any occurrence of capital letters (or numbers), pre-fix them with an &lsquo;_&rsquo; and then make everything lower case.</p>

<p>Example:</p>

<pre><code>       var data = new MyClass         {           FName = &quot;Raphael&quot;,           First1Name = &quot;Raph&quot;,           FirstName = &quot;Raph&quot;,           FirstName1 = &quot;Raph&quot;,           FirstName_ = &quot;Raph&quot;,           _FName = &quot;Raph&quot;,           _FirstName = &quot;Raph&quot;         };         var jsonSettings = new JsonSerializerSettings         {           ContractResolver = new SnakeCasePropertyNamesContractResolver(),           NullValueHandling = NullValueHandling.Ignore         };         var json = JsonConvert.SerializeObject(data, jsonSettings);//serialize object to snake_case1         var obj = JsonConvert.DeserializeObject&lt;MyClass&gt;(json, jsonSettings);//desserialize object from snake_case1         jsonSettings.ContractResolver = new SnakeCaseIntegerSeperatedPropertyNamesContractResolver();         json = JsonConvert.SerializeObject(data, jsonSettings);//serialize object to snake_case_2         obj = JsonConvert.DeserializeObject&lt;MyClass&gt;(json,jsonSettings); //deserialize object from snake_case_2  
</code></pre>

<p>MyClass here is:</p>

<pre><code>   public class MyClass     {       public string FirstName       {         get;         set;       }       public string FirstName1       {         get;         set;       }       public string First1Name       {         get;         set;       }       public string FName       {         get;         set;       }       public string _FirstName       {         get;         set;       }       public string FirstName_       {         get;         set;       }       public string _FName       {         get;         set;       }     }  
</code></pre>

<h3 id="the-result">The Result</h3>

<p>A NuGet Package that contains these two classes, that can be added to your project. They can be used to deserialise a JSON object into a POCO class. Or they can be used to serialise a POCO into JSON.</p>

<p>Here is the link: <a href="https://www.nuget.org/packages/Json.NET.ContractResolverExtentions/">https://www.nuget.org/packages/Json.NET.ContractResolverExtentions/</a></p>

<h3 id="thanks">Thanks!</h3>

<p>Thank you all for reading and a special thanks has to go to <a href="https://twitter.com/meligy">@Meligy</a> for helping me write this post :)</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="http://example.org/posts/my-first-couple-of-weeks-at-readify/"><i class="fa fa-chevron-circle-left"></i> My first couple of weeks at Readify</a>
        </li>
        
        
        <li>
            <a href="http://example.org/posts/json-serialisationdeserialisation-with-comments/">JSON serialisation/deserialisation with snake_case naming conventions <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    





</main>
    <footer>
        <h6> | 
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="http://example.org/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="/js/scripts.js"></script>
</body>

</html>